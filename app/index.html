<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Mecklenburg-Vorpommern,OpenStreetMap,ORKa.MV,Regionalkarte" />
    <meta name="description" content="Offene Regionalkarte Mecklenburg-Vorpommern (ORKa.MV) auf Basis von Katasterdaten und OpenStreetMap-Daten" />

    <title>ORKa.MV</title>

    <!-- Core CSS -->
    <link href="/anol/libs/bootstrap/bootstrap.css" rel="stylesheet">
    <link href="/anol/libs/ol3/ol3.css" rel="stylesheet">


    <!-- Custom styles -->
    <link href="/static/css/bootstrap-theme.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <!-- top navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Project name</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Profile</a></li>
            <li><a href="#">Help</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- main container -->
    <div class="container-fluid">
      <div class="row">

        <!-- sitebar -->
        <div class="col-sm-3 col-md-2">
          <div anol-layerswitcher></div>
          <hr>
          <div anol-layertree></div>
          <hr>
          <div anol-layertree-legend></div>
          <div anol-scale-text></div>
        </div>
        <!-- map -->
        <div anol-map class="col-sm-6 col-md-8">
          <div anol-mouse-position></div>
          <!-- Readd when custom defined projection 25833 can be transformed to 4326 by ol3 -->
          <!--<div anol-scale-line></div>-->
        </div>
        <div class="col-sm-3 col-md-2">
          <div anol-print ></div>
          <hr>
          <div anol-feature-list feature-layer="poi_layer" marker-layer="marker_layer">
            <div anol-feature-popup feature-layer="poi_layer"></div>
          </div>
        </div>

      </div>
    </div>

    <!-- Remove libs when build dist -->
    <script type="text/javascript" src="/anol/libs/jquery/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="/anol/libs/angular/angular-debug.js"></script>
    <script type="text/javascript" src="/anol/libs/ol3/ol3-debug.js"></script>


    <script type="text/javascript" src="/build/anol.js"></script>
    <script type="text/javascript" src="/config.js"></script>
    <script type="text/javascript">
      /**
       * to load config by path url is like:
       * http://localhost:7000/test/#/
       *
       * to load config by parameter url is like:
       * http://localhost:7000/?page=test/#
       */
      // TODO replace by jquery plugin or improve
      var getConfigName = function() {
        var path = [];
        $.each(window.location.pathname.split('/'), function(idx, pathComponent) {
          if(pathComponent !== '') {
            path.push(pathComponent);
          }
        });
        var byPath = path[path.length -1];

        var search = window.location.search;
        if(search[0] === '?') {
          search = search.slice(1, search.length);
        }
        if(search[search.length - 1] === '/') {
          search = search.slice(0, search.length - 1);
        }
        var params = {};
        $.each(search.split('&'), function(idx, param) {
          var p = param.split('=');
          params[p[0]] = p[1];
        });
        var byParam = params.page;

        return byParam || byPath;
      };

      angular.element(document).ready(function() {
          var deferred = new $.Deferred();
          var loadConfig = function(url) {
              var head = document.getElementsByTagName('head')[0];
              var script = document.createElement('script');
              script.type = 'text/javascript';
              script.src = url;

              var callback = function() {
                deferred.resolve();
              };

              // Then bind the event to the callback function.
              // There are several events for cross browser compatibility.
              script.onreadystatechange = callback;
              script.onload = callback;

              // Fire the loading
              head.appendChild(script);
          };

          deferred.promise().then(function() {
            angular.bootstrap(document, ['orkaApp']);
          });

          loadConfig('/static/data/' + getConfigName() + '_config.js');

      });
    </script>
  </body>
</html>
